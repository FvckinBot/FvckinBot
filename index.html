<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>FvckinBot™ Keno</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
   @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');
  </style>
 </head>
 <body class="bg-[#1a2c38] text-white min-h-screen">  
 	<header class="flex justify-between items-center rounded-b-2xl shadow-lg sticky top-0 z-50 bg-[#1a2c38] px-5 py-4 lg:px-8 lg:py-6">
		<h1 id="popupTitle" class="text-white text-lg md:text-xl lg:text-3xl font-semibold font-mono items-center">FvckinBot™ Keno</h1>
		<div id="casinoSite" class="text-white text-lg md:text-xl lg:text-3xl font-semibold font-mono items-center">Site: stake</div>
	  </header>
    <main id="mainContent" class="bg-[#1a2c38] text-white min-h-screen">
		<div class="p-4 space-y-3 max-w-xl mx-auto">
			<section class="flex rounded-2xl gap-3 w-full">
			 <button class="flex-1 bg-[#2f4553] rounded-xl px-2 py-1 text-sm hover:bg-[#526c80] w-[270px] " id="auto-pick-btn">
			 Auto Pick
			</button>
			<button class="flex-1 bg-[#2f4553] rounded-xl px-2 py-1 text-sm hover:bg-[#526c80] w-[270px]" id="clear-table-btn">
			 Clear Table
			</button>

				<div class="bg-[#0f212e] rounded-xl px-3 py-2 h-full w-full">
					<h3 class="flex-1 text-xs md:sm lg:text-sm ">Selected Numbers:</h3>
					<pre id="selected-numbers" class="whitespace-pre-wrap text-xs md:sm lg:text-sm ">[]</pre>
				</div>
			</section> 
			<section class="relative">
				<div class="bg-[#0f212e] px-2 py-2 lg:px-4 lg:py-4 grid grid-cols-8 gap-3 bg-[#0f212e] rounded-xl" id="number-grid"></div>
				<div class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#0f212e] border-3 border-[#00e33c] rounded-xl aspect-[1/1] px-2 py-2 lg:px-4 lg:py-4 justify-center items-center text-[#00ff3c] font-semibold select-none text-xl font-bold" id="payoutShow">1.60×</div>

			
			</section>

			<section class="flex flex-row rounded-2xl gap-3 ">

				<div class="bg-[#0f212e] rounded-xl px-3 py-2  w-full">
					<h3 class="flex-1 text-xs md:sm lg:text-sm ">Bet Results:</h3>
					<pre id="bet-results" class="whitespace-pre-wrap text-xs md:sm lg:text-sm ">[]</pre>
				</div>			
 				<button class=" bg-[#00c73c] rounded-xl px-3 py-2 font-semibold text-black text-xs md:sm lg:text-sm hover:bg-[#00e33c]" id="start-button">
					Start
				</button>
				<button class="bg-[#2f4553] rounded-xl px-3 py-2 font-semibold text-white text-xs md:sm lg:text-sm hover:bg-[#526c80] hidden" id="pause-button">
					Pause
				</button>
				<button class="bg-[#2f4553] rounded-xl px-3 py-2 font-semibold text-white text-xs md:sm lg:text-sm hover:bg-[#526c80] hidden" id="resume-button">
					Resume
				</button>
				<button class="bg-[#e9113c] rounded-xl px-3 py-2 font-semibold text-white text-xs md:sm lg:text-sm hover:bg-[#b30e2f] hidden" id="stop-button">
					Stop
				</button>
			
			</section>  
			<section class="flex rounded-2xl gap-3 w-full">
				<div class="bg-[#0f212e] rounded-xl p-3 w-full">
					<pre id="Balance" class="whitespace-pre-wrap text-white text-sm">Balance: ...</pre>
					<pre id="Profit" class="whitespace-pre-wrap text-white text-sm">Profit: ...</pre>
					<pre id="Wagered" class="whitespace-pre-wrap text-white text-sm">Wagered: ...</pre>
				</div>	
				<div class="bg-[#0f212e] rounded-xl p-3 w-full">
					<pre id="winCount" class="whitespace-pre-wrap text-[#00c73c] text-sm">Win  => 0 : 0 : 0</pre>
					<pre id="loseCount" class="whitespace-pre-wrap text-[#e9113c] text-sm">Lose => 0 : 0 : 0</pre>
					<pre id="highestPayout" class="whitespace-pre-wrap text-white text-sm">Payout => 0 : 0 High</pre>
				</div>
		
			</section>  
			<section class="bg-[#213743] p-6 flex flex-col space-y-4 rounded-2xl">
				<div>
					<div class="flex justify-between text-xs text-gray-400 mb-1">
						<label class="font-semibold" for="bet-amount">Bet Amount</label><span id="bet-amount-display">0.00000000 BTC</span>
					</div>
					<div class="flex space-x-1">
						<input class="flex-1 rounded-md bg-[#0f212e] text-white font-semibold text-sm px-3 py-2 outline-none" id="bet-amount" type="text" value="0.00"/>
						<button aria-label="Dollar sign" class="bg-[#2f4553] rounded-md px-3 py-2 font-semibold text-xs flex items-center justify-center">
							<i class="fas fa-dollar-sign text-[#00c73c]"></i>
						</button>
					</div>
				</div>
		<div>
			<label class=" hidden font-semibold text-sm mb-1 block" for="risk">Risk</label>
			<select class=" hidden w-full rounded-md bg-[#0f212e] text-white font-semibold text-sm px-3 py-2 outline-none" id="risk">
				<option value="classic">Classic</option>
				<option value="low">Low</option>
				<option value="medium">Medium</option>
				<option value="high">High</option>
			</select>
		</div>
   
   </section>

  </div>

  <script>
   (() => {
	const ARRAY_SIZE = 40;
	const RESULT_SIZE = 10;
    const apiKey = 'b568cfa781e3cad93b149e5699f4d0724613eb1cbaf104e36cad0a91d1a0b385fec2df7e7154503e4be94d2036771d74';
	let win ;
	let wins =  0
	let loses = 0
	let streakLose = 0
	let streakWin = 0
	let ctWin = 0
	let ctLose = 0
	let lastBet = {}
	let baseBet = 0
	let nextbet = baseBet
	let previousBet = 0
	let currency = "usdt"
	let balance ;
    let kenorisk = "medium"
	let highestPayout = 0
	let wagered = 0
	let tProfit = 0
	let cProfit = 0
	const apiHost = 'stake.com'
    const maxSelected = 10;
    const maxBet = 10;
	let running = false
    let selectedNumbers = [] ;
    let resultNumbers = [] ;
    const numberGrid = document.getElementById('number-grid');
    const startButton = document.getElementById('start-button');
    const stopButton = document.getElementById('stop-button');
    const selectedNumbersContainer = document.getElementById('selected-numbers');
    const betResultsContainer = document.getElementById('bet-results');
    const winContainer = document.getElementById('winCount');
    const loseContainer = document.getElementById('loseCount');
    const PayoutContainer = document.getElementById('highestPayout');
    const BalanceContainer = document.getElementById('Balance');
    const WageredContainer = document.getElementById('Wagered');
    const ProfitContainer = document.getElementById('Profit');
    const clearTableBtn = document.getElementById('clear-table-btn');
    const autoPickBtn = document.getElementById('auto-pick-btn');
    const payoutShow = document.getElementById('payoutShow');
    const betAmountDiv = document.getElementById('bet-amount');
    const betAmountDiv2 = document.getElementById('bet-amount-display');
	function randomString(length) {
		var chars = '_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';
		var result = '';
		for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
		return result;
	}
	async function getBalance() {
		const body = {
			operationName: `UserBalances`,
			query: "query UserBalances {\n  user {\n    id\n    balances {\n      available {\n        amount\n        currency\n        __typename\n      }\n      vault {\n        amount\n        currency\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"
		};
		const response = await fetch('https://' + apiHost + '/_api/graphql', {
			method: 'post',
			body:    JSON.stringify(body),
			headers: { 'Content-Type': 'application/json','x-access-token': apiKey},
		})
		if (!response.ok) {
			throw new Error(response.status+'Client Error: '+response.statusText);
		}
		return (await response.json()).data.user.balances.find(balance => balance.available.currency == currency)?.available.amount;
    }
	async function kenobet(){
		var body = {
			variables:{
			"amount": nextbet,
			"currency": currency,
			"identifier": randomString(21),
			"risk": kenorisk,
			"numbers": selectedNumbers
			},
			query:"mutation KenoBet($amount: Float!, $currency: CurrencyEnum!, $numbers: [Int!]!, $identifier: String!, $risk: CasinoGameKenoRiskEnum) {\n  kenoBet(\n    amount: $amount\n    currency: $currency\n    numbers: $numbers\n    risk: $risk\n    identifier: $identifier\n  ) {\n    ...CasinoBet\n    state {\n      ...CasinoGameKeno\n    }\n  }\n}\n\nfragment CasinoBet on CasinoBet {\n  id\n  active\n  payoutMultiplier\n  amountMultiplier\n  amount\n  payout\n  updatedAt\n  currency\n  game\n  user {\n    id\n    name\n  }\n}\n\nfragment CasinoGameKeno on CasinoGameKeno {\n  drawnNumbers\n  selectedNumbers\n  risk\n}\n"	}
			

		const response = await fetch('https://' + apiHost + '/_api/graphql', {
			method: 'post',
			body:    JSON.stringify(body),
			headers: { 'Content-Type': 'application/json','x-access-token': apiKey},
		})
		if (!response.ok) {
			throw new Error(response.status+'Client Error: '+response.statusText);
		}
		return response.json();
	}
	function renderStat(){
		winContainer.textContent = `Win  => ${ctWin} : ${streakWin} : ${wins} `;
		loseContainer.textContent = `Lose => ${ctLose} : ${streakLose} : ${loses} `;
		PayoutContainer.textContent = `Payout => : ${lastBet.payout} : ${highestPayout} `;
		BalanceContainer.textContent = `Balance: ${balance.toFixed(8)} ${currency.toUpperCase()}`;
		ProfitContainer.textContent = `Profit: ${tProfit.toFixed(8)} ${currency.toUpperCase()}`;
		WageredContainer.textContent = `Wagered: ${wagered.toFixed(8)} ${currency.toUpperCase()}`;
	}	
	function renderPayout(){
		if(lastBet.payout > 1){
			payoutShow.textContent = `${lastBet.payout}×`
			payoutShow.classList.remove("hidden")
		}else{
			payoutShow.classList.add("hidden")
		}
	}
    function updateButtonState() {
		startButton.disabled = selectedNumbers.size === 0;
    }
	function clearButtonDisplay(div){
		const classes = Array.from(div.classList);
		const classesToRemove = classes.filter(className => className.startsWith('bg-') || className.startsWith('text-') || className.startsWith('hover:bg-'));
		classesToRemove.forEach(className => div.classList.remove(className));
	}
    function toggleNumber(div) {
		const num = Number(div.dataset.number);
		if (selectedNumbers.includes(num)) {
			selectedNumbers = selectedNumbers.filter(n => n !== num);
        } else {
			if (selectedNumbers.length < maxSelected) {
				selectedNumbers.push(num);
			}
        }
		displaySelected()
    }

    function renderBoxNumbers() {
      numberGrid.innerHTML = '';
		for (let i = 0; i < 40; i++) {
			const box = document.createElement('div');
			box.className = 'bg-[#2f4553] aspect-[1/1] rounded-md flex justify-center items-center font-semibold text-lg cursor-pointer hover:bg-[#526c80]';
			box.textContent = (i + 1).toString();
			box.dataset.number = i.toString();
			box.addEventListener('click', () => {
				toggleNumber(box);
			});
			numberGrid.appendChild(box);
		}
    }
    function displaySelected() {
		Array.from(numberGrid.children).forEach(div => {
			const num = Number(div.dataset.number);
			if (selectedNumbers.includes(num)) {
				clearButtonDisplay(div)
				div.classList.add('bg-[#962eff]', 'text-white', 'hover:bg-[##a85ef3]');
				
			} else {
				clearButtonDisplay(div)
				div.classList.add('bg-[#2f4553]', 'text-white', 'hover:bg-[#526c80]');
				
			}
		});
		const arr = selectedNumbers
			.sort((a, b) => a - b);
		selectedNumbersContainer.textContent = JSON.stringify(arr);
    }
    clearTableBtn.addEventListener('click', () => {
		selectedNumbers = [];
		resultNumbers = [];
		displaySelected()
    });
    function displayResult() {
		displaySelected() 
		const arr = resultNumbers
			.sort((a, b) => a - b);
		betResultsContainer.textContent = JSON.stringify(arr);
		resultNumbers.forEach(num => {
			const div = numberGrid.querySelector(`[data-number="${num}"]`);
			if (!div) return;
			if (selectedNumbers.includes(num)) {
				clearButtonDisplay(div)
				//selectedNumbers = selectedNumbers.filter(n => n !== num);
				div.classList.add('bg-[#00e33c]', 'text-black');
			}else{
				clearButtonDisplay(div)
				div.classList.add('bg-[#0b1c29]', 'text-red-500');
			}
		});
    }
    async function startBet() {
		balance = await getBalance()
		const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
		baseBet = parseFloat(betAmountDiv.value)
		nextbet = baseBet
		while (running) {
			resultNumbers = []
			betAmountDiv.value = nextbet.toFixed(8)
			betAmountDiv2.innerText  = `${nextbet.toFixed(8)} ${currency.toUpperCase()}`
			try{
				const betData = (await kenobet()).data.kenoBet
				if(betData){
					lastBet.amount = betData.amount;
					lastBet.payout = betData.payoutMultiplier;
					lastBet.roll   = betData.state.drawnNumbers;
					lastBet.profit = parseFloat(betData.payout) - parseFloat(betData.amount);
					lastBet.target = betData.state.selectedNumbers;
					highestPayout = Math.max(highestPayout,lastBet.payout)
					balance += lastBet.profit
					tProfit += lastBet.profit
					cProfit += lastBet.profit

					wagered += lastBet.amount
					if(lastBet.payout >= 1 ){
						lastBet.win = true;
						win = true
						ctWin += 1
						wins += 1
						ctLose = 0
						streakWin = Math.max(ctWin,streakWin)
						nextbet =  parseFloat(lastBet.amount) * ((parseFloat(lastBet.payout)/4)+1)
					}else{
						lastBet.win = false;
						ctWin = 0
						ctLose += 1
						loses += 1
						streakLose = Math.max(ctLose,streakLose)
					}
					if(cProfit >= 0){
						cProfit = 0
						nextbet = baseBet
					}
					resultNumbers = lastBet.roll
					displayResult();
					renderPayout()
					renderStat()
					if(lastBet.payout == 4){
						autoPick()
					}
					//autoPick()
				}
			
			}catch(err){
				console.log(err)
			}
			//running = false
		}
		payoutShow.classList.add("hidden")
		startButton.classList.remove('hidden');
		clearTableBtn.classList.remove('hidden');
		autoPickBtn.classList.remove('hidden');
		stopButton.classList.add('hidden');
		selectedNumbers = [];
		resultNumbers = [];
    }
	function generateGaussian() {
	  const numbers = new Set();

	  function boxMuller() {
		let u = 0, v = 0;
		while (u === 0) u = Math.random(); // Converting [0,1) to (0,1)
		while (v === 0) v = Math.random();
		return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
	  }

	  while (numbers.size < ARRAY_SIZE) {
		const z = boxMuller();
		// Normalize z into range 0..39
		// Assuming mean 19.5, stddev ~7, clamp in 0-39
		let num = Math.round(z * 7 + 19.5);
		if (num < 0) num = 0;
		if (num >= ARRAY_SIZE) num = ARRAY_SIZE - 1;
		numbers.add(num);
	  }
	  return Array.from(numbers);
	}
	function generateBinaryFind() {
	  let array = generateGaussian()
	  const numbers = new Set();

	  // We'll repeatedly choose midpoints and randomly decide to pick or move left/right to simulate randomness
	  while (numbers.size < RESULT_SIZE && array.length > 0) {
		let left = 0;
		let right = array.length - 1;

		while (left <= right) {
		  const mid = Math.floor((left + right) / 2);

		  // With 50% chance, pick midpoint
		  if (Math.random() < 0.5) {
			numbers.add(array[mid]);
			array.splice(mid, 1); // Remove chosen number
			break;
		  } else {
			// Otherwise decide randomly left or right segment for next iteration
			if (Math.random() < 0.5) {
			  right = mid - 1;
			} else {
			  left = mid + 1;
			}
		  }
		}

		// If while loop exits without picking (rare due to logic), pick random element anyway
		if (numbers.size < RESULT_SIZE && (left > right)) {
		  // Pick random from array
		  const idx = Math.floor(Math.random() * array.length);
		  numbers.add(array[idx]);
		  array.splice(idx, 1);
		}
	  }

	  // Defensive fallback if less than RESULT_SIZE numbers selected due to logic
	  while (numbers.size < RESULT_SIZE && array.length > 0) {
		numbers.add(array.pop());
	  }

	  return Array.from(numbers);
	}
	async function autoPick() {
		selectedNumbers = generateBinaryFind()
		//console.log(selectedNumbers)
    }
	
    startButton.addEventListener('click', async () => {
		if (selectedNumbers.length === 0) {
			autoPick()
		}
		stopButton.classList.remove('hidden');
		startButton.classList.add('hidden');
		autoPickBtn.classList.add('hidden');
		clearTableBtn.classList.add('hidden');
		startButton.classList.add('hidden');
		running = true
		startBet()
	});
	stopButton.addEventListener('click', async () => {
		running = false
		startButton.classList.remove('hidden');
		stopButton.classList.add('hidden');
	});
    autoPickBtn.addEventListener('click', ()=>{
		autoPick()
		displayResult()
		payoutShow.classList.add("hidden")
	
	});
	//startScoket()
    renderBoxNumbers()
  })();
  </script>
 </body>
</html>
